import subprocess
from sentinelx_backend.config import Config
from sentinelx_backend.libs.tools.vulnerability.registry import register

@register("nmap")
class NmapScanner:
    def run(self, target: str):
        if not Config.ENABLE_NMAP:
            raise RuntimeError("Nmap is disabled in Config. Set ENABLE_NMAP=1 to enable.")
        cmd = [Config.NMAP_PATH, "-T4", "-F", target]
        try:
            result = subprocess.run(cmd, capture_output=True, text=True, check=True)
            return {"target": target, "output": result.stdout}
        except subprocess.CalledProcessError as e:
            return {"target": target, "error": e.stderr}
